# This workflow will build and deploy the docker image to test/production based on the branch.

name: Build

# Runs build on every push up
on:
  pull_request:
    branches:
      - develop
      - main

jobs:
  build:
    name: Build
    runs-on: [ self-hosted, linux ]
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
      - name: Gradle Build
        run: ./gradlew build --parallel



  slack:
    name: Send Slack Message
    runs-on: [ linux, self-hosted ]
    needs: [ build ] # Include all jobs that should be in message
    if: always()
    steps:
      - name: Checkout Shared Actions
        uses: actions/checkout@v2-beta
        with:
          repository: FigureTechnologies/shared-actions
          ref: main
          token: ${{secrets.PAT}}
          path: shared-actions
      - name: Notify via Slack
        uses: ./shared-actions/notify-slack-action
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_DEPLOYMENTS_WEBHOOK }}
        with:
          needs: ${{ toJSON(needs) }}
          emoji: ":deathpledge:"
